
#include <string.h>
#include "STE2007.h"
//*****************************************************************************
// DEFINE CHARACTER FONTS
//*****************************************************************************
const char ASCII[][6] ={
   {0x00, 0x00, 0x00, 0x00, 0x00, 0x00} // 20
  ,{0x00, 0x00, 0x00, 0x5f, 0x00, 0x00} // 21 !
  ,{0x00, 0x00, 0x07, 0x00, 0x07, 0x00} // 22 "
  ,{0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14} // 23 #
  ,{0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12} // 24 $
  ,{0x00, 0x23, 0x13, 0x08, 0x64, 0x62} // 25 %
  ,{0x00, 0x36, 0x49, 0x55, 0x22, 0x50} // 26 &
  ,{0x00, 0x00, 0x05, 0x03, 0x00, 0x00} // 27 '
  ,{0x00, 0x00, 0x1c, 0x22, 0x41, 0x00} // 28 (
  ,{0x00, 0x00, 0x41, 0x22, 0x1c, 0x00} // 29 )
  ,{0x00, 0x14, 0x08, 0x3e, 0x08, 0x14} // 2a *
  ,{0x00, 0x08, 0x08, 0x3e, 0x08, 0x08} // 2b +
  ,{0x00, 0x00, 0x50, 0x30, 0x00, 0x00} // 2c ,
  ,{0x00, 0x08, 0x08, 0x08, 0x08, 0x08} // 2d -
  ,{0x00, 0x00, 0x60, 0x60, 0x00, 0x00} // 2e .
  ,{0x00, 0x20, 0x10, 0x08, 0x04, 0x02} // 2f /
  ,{0x00, 0x3e, 0x51, 0x49, 0x45, 0x3e} // 30 0
  ,{0x00, 0x00, 0x42, 0x7f, 0x40, 0x00} // 31 1
  ,{0x00, 0x42, 0x61, 0x51, 0x49, 0x46} // 32 2
  ,{0x00, 0x21, 0x41, 0x45, 0x4b, 0x31} // 33 3
  ,{0x00, 0x18, 0x14, 0x12, 0x7f, 0x10} // 34 4
  ,{0x00, 0x27, 0x45, 0x45, 0x45, 0x39} // 35 5
  ,{0x00, 0x3c, 0x4a, 0x49, 0x49, 0x30} // 36 6
  ,{0x00, 0x01, 0x71, 0x09, 0x05, 0x03} // 37 7
  ,{0x00, 0x36, 0x49, 0x49, 0x49, 0x36} // 38 8
  ,{0x00, 0x06, 0x49, 0x49, 0x29, 0x1e} // 39 9
  ,{0x00, 0x00, 0x36, 0x36, 0x00, 0x00} // 3a :
  ,{0x00, 0x00, 0x56, 0x36, 0x00, 0x00} // 3b ;
  ,{0x00, 0x08, 0x14, 0x22, 0x41, 0x00} // 3c <
  ,{0x00, 0x14, 0x14, 0x14, 0x14, 0x14} // 3d =
  ,{0x00, 0x00, 0x41, 0x22, 0x14, 0x08} // 3e >
  ,{0x00, 0x02, 0x01, 0x51, 0x09, 0x06} // 3f ?
  ,{0x00, 0x32, 0x49, 0x79, 0x41, 0x3e} // 40 @
  ,{0x00, 0x7e, 0x11, 0x11, 0x11, 0x7e} // 41 A
  ,{0x00, 0x7f, 0x49, 0x49, 0x49, 0x36} // 42 B
  ,{0x00, 0x3e, 0x41, 0x41, 0x41, 0x22} // 43 C
  ,{0x00, 0x7f, 0x41, 0x41, 0x22, 0x1c} // 44 D
  ,{0x00, 0x7f, 0x49, 0x49, 0x49, 0x41} // 45 E
  ,{0x00, 0x7f, 0x09, 0x09, 0x09, 0x01} // 46 F
  ,{0x00, 0x3e, 0x41, 0x49, 0x49, 0x7a} // 47 G
  ,{0x00, 0x7f, 0x08, 0x08, 0x08, 0x7f} // 48 H
  ,{0x00, 0x00, 0x41, 0x7f, 0x41, 0x00} // 49 I
  ,{0x00, 0x20, 0x40, 0x41, 0x3f, 0x01} // 4a J
  ,{0x00, 0x7f, 0x08, 0x14, 0x22, 0x41} // 4b K
  ,{0x00, 0x7f, 0x40, 0x40, 0x40, 0x40} // 4c L
  ,{0x00, 0x7f, 0x02, 0x0c, 0x02, 0x7f} // 4d M
  ,{0x00, 0x7f, 0x04, 0x08, 0x10, 0x7f} // 4e N
  ,{0x00, 0x3e, 0x41, 0x41, 0x41, 0x3e} // 4f O
  ,{0x00, 0x7f, 0x09, 0x09, 0x09, 0x06} // 50 P
  ,{0x00, 0x3e, 0x41, 0x51, 0x21, 0x5e} // 51 Q
  ,{0x00, 0x7f, 0x09, 0x19, 0x29, 0x46} // 52 R
  ,{0x00, 0x46, 0x49, 0x49, 0x49, 0x31} // 53 S
  ,{0x00, 0x01, 0x01, 0x7f, 0x01, 0x01} // 54 T
  ,{0x00, 0x3f, 0x40, 0x40, 0x40, 0x3f} // 55 U
  ,{0x00, 0x1f, 0x20, 0x40, 0x20, 0x1f} // 56 V
  ,{0x00, 0x3f, 0x40, 0x38, 0x40, 0x3f} // 57 W
  ,{0x00, 0x63, 0x14, 0x08, 0x14, 0x63} // 58 X
  ,{0x00, 0x07, 0x08, 0x70, 0x08, 0x07} // 59 Y
  ,{0x00, 0x61, 0x51, 0x49, 0x45, 0x43} // 5a Z
  ,{0x00, 0x00, 0x7f, 0x41, 0x41, 0x00} // 5b [
  ,{0x00, 0x02, 0x04, 0x08, 0x10, 0x20} // 5c %
  ,{0x00, 0x00, 0x41, 0x41, 0x7f, 0x00} // 5d ]
  ,{0x00, 0x04, 0x02, 0x01, 0x02, 0x04} // 5e ^
  ,{0x00, 0x40, 0x40, 0x40, 0x40, 0x40} // 5f _
  ,{0x00, 0x00, 0x01, 0x02, 0x04, 0x00} // 60 `
  ,{0x00, 0x20, 0x54, 0x54, 0x54, 0x78} // 61 a
  ,{0x00, 0x7f, 0x48, 0x44, 0x44, 0x38} // 62 b
  ,{0x00, 0x38, 0x44, 0x44, 0x44, 0x20} // 63 c
  ,{0x00, 0x38, 0x44, 0x44, 0x48, 0x7f} // 64 d
  ,{0x00, 0x38, 0x54, 0x54, 0x54, 0x18} // 65 e
  ,{0x00, 0x08, 0x7e, 0x09, 0x01, 0x02} // 66 f
  ,{0x00, 0x0c, 0x52, 0x52, 0x52, 0x3e} // 67 g
  ,{0x00, 0x7f, 0x08, 0x04, 0x04, 0x78} // 68 h
  ,{0x00, 0x00, 0x44, 0x7d, 0x40, 0x00} // 69 i
  ,{0x00, 0x20, 0x40, 0x44, 0x3d, 0x00} // 6a j
  ,{0x00, 0x7f, 0x10, 0x28, 0x44, 0x00} // 6b k
  ,{0x00, 0x00, 0x41, 0x7f, 0x40, 0x00} // 6c l
  ,{0x00, 0x7c, 0x04, 0x18, 0x04, 0x78} // 6d m
  ,{0x00, 0x7c, 0x08, 0x04, 0x04, 0x78} // 6e n
  ,{0x00, 0x38, 0x44, 0x44, 0x44, 0x38} // 6f o
  ,{0x00, 0x7c, 0x14, 0x14, 0x14, 0x08} // 70 p
  ,{0x00, 0x08, 0x14, 0x14, 0x18, 0x7c} // 71 q
  ,{0x00, 0x7c, 0x08, 0x04, 0x04, 0x08} // 72 r
  ,{0x00, 0x48, 0x54, 0x54, 0x54, 0x20} // 73 s
  ,{0x00, 0x04, 0x3f, 0x44, 0x40, 0x20} // 74 t
  ,{0x00, 0x3c, 0x40, 0x40, 0x20, 0x7c} // 75 u
  ,{0x00, 0x1c, 0x20, 0x40, 0x20, 0x1c} // 76 v
  ,{0x00, 0x3c, 0x40, 0x30, 0x40, 0x3c} // 77 w
  ,{0x00, 0x44, 0x28, 0x10, 0x28, 0x44} // 78 x
  ,{0x00, 0x0c, 0x50, 0x50, 0x50, 0x3c} // 79 y
  ,{0x00, 0x44, 0x64, 0x54, 0x4c, 0x44} // 7a z
  ,{0x00, 0x00, 0x08, 0x36, 0x41, 0x00} // 7b {
  ,{0x00, 0x00, 0x00, 0x7f, 0x00, 0x00} // 7c |
  ,{0x00, 0x00, 0x41, 0x36, 0x08, 0x00} // 7d }
  ,{0x00, 0x10, 0x08, 0x08, 0x10, 0x08} // 7e ->
  ,{0x00, 0x78, 0x46, 0x41, 0x46, 0x78} // 7f <-
};
//*****************************************************************************
//GLCD FontName : Tahoma12x16
//GLCD FontSize : 12 x 16
const char Tahoma_big[][24] = {
        {0x00, 0x1F, 0x3F, 0x60, 0x40, 0x40, 0x40, 0x60, 0x3F, 0x1F, 0x00, 0x00, 0x00, 0xE0, 0xF0, 0x18, 0x08, 0x08, 0x08, 0x18, 0xF0, 0xE0, 0x00, 0x00}, // Code for char 0
        {0x00, 0x00, 0x10, 0x10, 0x7F, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0xF8, 0xF8, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00}, // Code for char 1
        {0x00, 0x30, 0x70, 0x40, 0x40, 0x40, 0x41, 0x63, 0x3E, 0x1C, 0x00, 0x00, 0x00, 0x08, 0x18, 0x38, 0x68, 0xC8, 0x88, 0x08, 0x08, 0x08, 0x00, 0x00}, // Code for char 2
        {0x00, 0x30, 0x70, 0x40, 0x42, 0x42, 0x42, 0x67, 0x3D, 0x18, 0x00, 0x00, 0x00, 0x30, 0x38, 0x08, 0x08, 0x08, 0x08, 0x18, 0xF0, 0xE0, 0x00, 0x00}, // Code for char 3
        {0x00, 0x00, 0x80, 0x01, 0x80, 0x02, 0x80, 0x04, 0x80, 0x08, 0x80, 0x10, 0x80, 0x20, 0xF8, 0x7F, 0xF8, 0x7F, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00}, // Code for char 4
        {0x00, 0x00, 0x7C, 0x7C, 0x44, 0x44, 0x44, 0x46, 0x43, 0x41, 0x00, 0x00, 0x00, 0x30, 0x38, 0x08, 0x08, 0x08, 0x08, 0x18, 0xF0, 0xE0, 0x00, 0x00}, // Code for char 5
        {0x00, 0x0F, 0x1F, 0x34, 0x64, 0x44, 0x44, 0x46, 0x43, 0x01, 0x00, 0x00, 0x00, 0xE0, 0xF0, 0x18, 0x08, 0x08, 0x08, 0x18, 0xF0, 0xE0, 0x00, 0x00}, // Code for char 6
        {0x00, 0x40, 0x40, 0x40, 0x40, 0x41, 0x47, 0x5E, 0x78, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x78, 0xE0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00}, // Code for char 7
        {0x00, 0x18, 0x3D, 0x67, 0x42, 0x42, 0x42, 0x67, 0x3D, 0x18, 0x00, 0x00, 0x00, 0xE0, 0xF0, 0x18, 0x08, 0x08, 0x08, 0x18, 0xF0, 0xE0, 0x00, 0x00}, // Code for char 8
        {0x00, 0x1E, 0x3F, 0x61, 0x40, 0x40, 0x40, 0x60, 0x3F, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x08, 0x88, 0x88, 0x88, 0x98, 0xB0, 0xE0, 0xC0, 0x00, 0x00}, // Code for char 9
        {0x00, 0x00, 0x00, 0x0E, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}  // Code for char :
        };

//*****************************************************************************
//*****************************************************************************
// MODULE PUBLIC FUNCTION:
// lcd_init(void)					: Initialize LCD
// lcd_write(char dc, char byte)	: Send data or command to LCD
//									  dc = FLAG_CMD  : command
//									  dc = FLAG_DATA : data
// lcd_refresh(void)				: Refresh LCD
// lcd_clear(void)					: Clear all pixels on LCD
// lcd_gotoxy(unsigned char col, unsigned char row)	: Set pointer to coordinate(column, row)
// lcd_normal(void)					: Set LCD to normal state (display on, invert off,...)
// lcd_contrast(unsigned char value): Set LCD contrast
// lcd_all(void)					: Display all pixels
// lcd_putc(char c)					: Display ASCII character on LCD
// lcd_puts(char *s)				: Display character string on LCD
//*****************************************************************************
// khong can dung SPI ma dung cach thuc giao tiep SPI, moi lan gui 1 bit se tao 1 xung clock mem de gia lap xung clock
void lcd_write(char dc, char byte){
	char i;
	if(dc) LCD_SDIN_HIGH;
	else LCD_SDIN_LOW;
	LCD_SCE_LOW;
//	lcd_delay(CPU_CLOCK_MHZ);
	LCD_SCL_HIGH;
//	lcd_delay(CPU_CLOCK_MHZ);
	LCD_SCL_LOW;
//	lcd_delay(CPU_CLOCK_MHZ);
	// shift data out
	for(i = 0; i < 8; i++){
		if((byte<<i) & 0x80) LCD_SDIN_HIGH;
		else LCD_SDIN_LOW;
		LCD_SCL_HIGH;
//		lcd_delay(CPU_CLOCK_MHZ);
		LCD_SCL_LOW;
//		lcd_delay(CPU_CLOCK_MHZ);
	}
	LCD_SCE_HIGH;
//	lcd_delay(CPU_CLOCK_MHZ);
}
//*****************************************************************************
// khoi tao LCD la cau hinh cac chan cho dung chuc nang.
void lcd_init(void){
// 	LCD_PIN_TYPE_OUTPUT;
	lcd_Init_HaW();
	LCD_RESET_LOW;
	LCD_SCE_HIGH;
	LCD_SCL_LOW;
	LCD_RESET_HIGH;
	lcd_write(FLAG_CMD, 0x22);
	lcd_write(FLAG_CMD, 0x82);
	lcd_write(FLAG_CMD, 0xA4);
	lcd_write(FLAG_CMD, 0x2F);
	lcd_write(FLAG_CMD, 0xAF);
	lcd_clear();
}

//*****************************************************************************
void lcd_refresh(void){
	LCD_RESET_LOW;
//	lcd_delay(CPU_CLOCK_MHZ);
	LCD_RESET_HIGH;
	lcd_write(FLAG_CMD, LCD_CHARGE_PUMP_ON);
	lcd_contrast(LCD_CONTRAST);
	lcd_normal();
}

//*****************************************************************************
void lcd_clear(void){
  unsigned int index;
  lcd_gotoxy(0,0);
  for(index=0; index < 864; index++){
    lcd_write(FLAG_DATA,0x00);
  }
  lcd_gotoxy(0,0);
}

//*****************************************************************************
void lcd_gotoxy(unsigned char col, unsigned char row){
	 lcd_write(FLAG_CMD,LCD_CHANGE_COL_LSB | ( col & 0x0F));
	 lcd_write(FLAG_CMD,LCD_CHANGE_COL_MSB | ((col >> 4) & 0x07 ));
	 lcd_write(FLAG_CMD,LCD_CHANGE_ROW | (row & 0x0F));
}

//*****************************************************************************
void lcd_normal(void){
  lcd_write(FLAG_CMD,LCD_MODE|ON);
  lcd_write(FLAG_CMD,LCD_MODE|NORMAL);
  lcd_write(FLAG_CMD,LCD_MODE|DISPLAY);
  lcd_write(FLAG_CMD,LCD_RAM_ADDR_VER_MODE);
}

//*****************************************************************************
void lcd_all(void){
  lcd_write(FLAG_CMD,LCD_MODE|DISPLAY|ON);
  lcd_write(FLAG_CMD,LCD_MODE|ALL|ON);
}
//*****************************************************************************
void lcd_invert(unsigned char on_off){
	if (on_off==1)
		lcd_write(FLAG_CMD,0xA7);		
	else
		lcd_write(FLAG_CMD,0xA6);
}
//*****************************************************************************
/*void lcd_number_line(unsigned char num_line){
	switch (num_line)
	{
		case 68:
			lcd_write(FLAG_CMD,0xD0); break;
		case 65:
			lcd_write(FLAG_CMD,0xD1); break;
		case 49:
			lcd_write(FLAG_CMD,0xD2); break;
		case 33:
			lcd_write(FLAG_CMD,0xD3); break;
		case 34: // 33 line partial display
			lcd_write(FLAG_CMD,0xD4); break;
		case 25:
			lcd_write(FLAG_CMD,0xD5); break;
		case 17:
			lcd_write(FLAG_CMD,0xD6); break;
		case 9:
			lcd_write(FLAG_CMD,0xD7); break;
	}
}
*/
//*****************************************************************************
/*unsigned char lcd_read_ID(void){
	unsigned char i, data=0;
	LCD_SDIN_LOW;
	LCD_SCE_LOW;
//	lcd_delay(CPU_CLOCK_MHZ);
	LCD_SCL_HIGH;
//	lcd_delay(CPU_CLOCK_MHZ);
	LCD_SCL_LOW;
//	lcd_delay(CPU_CLOCK_MHZ);
	// shift data out
	for(i = 0; i < 8; i++){
		if((0xDB<<i) & 0x80) LCD_SDIN_HIGH;
		else LCD_SDIN_LOW;
		LCD_SCL_HIGH;
//		lcd_delay(CPU_CLOCK_MHZ);
		LCD_SCL_LOW;
//		lcd_delay(CPU_CLOCK_MHZ);
	}
	//shift data in
	TRISD=0x04;
	for(i = 0; i < 8; i++){
		if(RD2==1)
			data=(data|1)<<1;
		else 
			data=(data|0)<<1;
		LCD_SCL_HIGH;
//		lcd_delay(CPU_CLOCK_MHZ);
		LCD_SCL_LOW;
//		lcd_delay(CPU_CLOCK_MHZ);
	}
	LCD_SCE_HIGH;
	TRISD=0x00;
	return data;
//	lcd_delay(CPU_CLOCK_MHZ);
}
*/
//*****************************************************************************
void lcd_display_all(unsigned char value){
  lcd_write(FLAG_CMD,0xA4|value);
}
//*****************************************************************************
/*
void lcd_imag(int imag[]){
  	for(int i = 0; i < 768; i++){
			lcd_write(FLAG_DATA, imag[i]);
	}
}
*/
//*****************************************************************************
void lcd_contrast(unsigned char value){
  lcd_write(FLAG_CMD,LCD_VOB_MSB|0x04);
  lcd_write(FLAG_CMD,LCD_VOB_LSB|(value & 0x1F));
}
//*****************************************************************************
void lcd_start_line(unsigned char line){
  lcd_write(FLAG_CMD,0x40|line);
}
//*****************************************************************************
void lcd_str_center(char *str){
	unsigned char col = (96-strlen(str)*6)/2;
	lcd_goto_x(col);
	lcd_puts(str);
}
//*****************************************************************************
void lcd_goto_x(unsigned char col){
	lcd_write(FLAG_CMD,LCD_CHANGE_COL_LSB | ( col & 0x0F));        // go to x
	lcd_write(FLAG_CMD,LCD_CHANGE_COL_MSB | ((col >> 4) & 0x07 ));
}
//*****************************************************************************
void lcd_goto_y(unsigned char row){
	 lcd_write(FLAG_CMD,LCD_CHANGE_ROW | (row & 0x0F));
}
//*****************************************************************************
void lcd_segment_direction(unsigned char reverse) // mirror y
{
    if(reverse)
		lcd_write(FLAG_CMD,0xA1); // 1 is reverse segment direction
    else
        lcd_write(FLAG_CMD,0xA0); // 0 is normal segment direction
}
//*****************************************************************************
void lcd_column_direction(unsigned char reverse) // mirror x
{
    if(reverse)
		lcd_write(FLAG_CMD,0xC8); // 1 is reverse column direction
    else
        lcd_write(FLAG_CMD,0xC0); // 0 is normal column direction
}
//*****************************************************************************
void lcd_putc(char c){
	if((c >= 0x20) && (c <= 0x7f)){
		char i;
		c -= 0x20;
		for(i = 0; i < 6; i++){
			lcd_write(FLAG_DATA, ASCII[c][i]);
		}
	}
}

//*****************************************************************************
void lcd_bigC(int row, int col, char c){
	int i,j;
	if ((c>=0x30)&&(c<=0x3A)){
		c-=0x30;
		lcd_gotoxy(col,row);
		for(j = 12; j < 24; j++){
			lcd_write(FLAG_DATA, Tahoma_big[c][j]);
		}
		lcd_gotoxy(col,row+1);
		for(i = 0; i < 12; i++){
			lcd_write(FLAG_DATA, Tahoma_big[c][i]);
		}
	}
}
//*****************************************************************************
void lcd_puts(char *s){
	while(*s){
		lcd_putc(*s++);
	}
}
//*****************************************************************************
void lcd_delay(int cycles){
	int i;
	for(i = cycles; i >= 1; i--);
}
//********************************************************************************
// CONFIG CHAN CHO STM M4
//*****************************************************************************
void lcd_Init_HaW(void)
{
	GPIO_InitTypeDef  GPIO_InitStructure;
 /* GPIOD Periph clock enable */
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOB, ENABLE);

  /* Configure PD12, PD13, PD14 and PD15 in output pushpull mode */
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12 | GPIO_Pin_13| GPIO_Pin_14| GPIO_Pin_15;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
  GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
  GPIO_Init(GPIOB, &GPIO_InitStructure);
}



